<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring a proxy for external network access :: RHACS Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">RHACS Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhacs" data-version="64">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat Advance Cluster Security for Kubernetes</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Welcome</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Release notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/364-release-notes.html">Relase notes for RHACS 3.64</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/363-release-notes.html">Release notes for RHACS 3.63</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3062-release-notes.html">Release notes for RHACS 3.0.62</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3061-release-notes.html">Release notes for RHACS 3.0.61</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3060-release-notes.html">Release notes for RHACS 3.0.60</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3059-release-notes.html">Release notes for RHACS 3.0.59</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3058-release-notes.html">Release notes for RHACS 3.0.58</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture/index.html">Product architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/prerequisites.html">Installation prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/install-ocp-operator.html">Installing by using an Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installing by using Helm charts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installing/installing_helm/install-helm-quick.html">Installing quickly</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installing/installing_helm/install-helm-customization.html">Installing with customizations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/install-quick-roxctl.html">Installing quickly by using the roxctl CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/uninstall-acs.html">Uninstalling RHACS</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuring</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-custom-certificates.html">Adding custom certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-trusted-ca.html">Adding trusted certificate authorities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reissue-internal-certificates.html">Reissuing internal certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-security-notices.html">Adding security notices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enable-offline-mode.html">Enabling offline mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enable-alert-data-retention.html">Enabling alert data retention</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="expose-portal-over-http.html">Exposing the RHACS portal over HTTP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-automatic-upgrades.html">Configuring automatic upgrades for secured clusters</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configure-proxy.html">Configuring a proxy for external network access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="generate-diagnostic-bundle.html">Generating a diagnostic bundle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-endpoints.html">Configuring endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitor-acs.html">Monitoring with Prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-audit-logging.html">Enabling audit logging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/view-dashboard.html">Viewing the dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-compliance.html">Managing compliance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/evaluate-security-risks.html">Evaluating security risks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/use-admission-controller-enforcement.html">Using admission controller enforcement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-security-policies.html">Managing security policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-network-policies.html">Managing network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/review-cluster-configuration.html">Reviewing cluster configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/examine-images-for-vulnerabilities.html">Examining images for vulnabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-vulnerabilities.html">Managing vulnerabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/respond-to-violations.html">Responding to violations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/search-filter.html">Searching and filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Managing user access</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/configure-okta-identity-cloud.html">Configuring Okta Identity Cloud as a SAML 2.0 identity provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/configure-google-workspace-identity.html">Configuring Google Workspace as an OIDC identity provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/manage-role-based-access-control-3630.html">Managing RBAC in Red Hat Advanced Cluster Security for Kubernetes 3.63 and newer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/manage-role-based-access-control-3062.html">Managing RBAC in Red Hat Advanced Cluster Security for Kubernetes 3.0.62 and older</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/enable-pki-authentication.html">Enabling PKI authentication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/use-system-health-dashboard.html">Using the system health dashboard</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Backup and restore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup_and_restore/backing-up-acs.html">Backing up Red Hat Advanced Cluster Security for Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup_and_restore/restore-acs.html">Restoring from a backup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Upgrading</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrading/upgrade-helm.html">Upgrading using Helm charts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Upgrading using the roxctl CLI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#upgrading_roxctl/upgrade-from-44">Upgrading from Red Hat Advanced Cluster Security for Kubernetes 3.0.44 or higher</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cli/getting-started-cli.html">Getting started with the roxctl CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../support/getting-support.html">Getting support for Red Hat Advanced Cluster Security for Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../support/getting-support-stackrox.html">Getting support for the StackRox Kubernetes Security Platform</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat Advance Cluster Security for Kubernetes</span>
    <span class="version">64</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat Advance Cluster Security for Kubernetes</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">64</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat Advance Cluster Security for Kubernetes</a></li>
    <li>Configuring</li>
    <li><a href="configure-proxy.html">Configuring a proxy for external network access</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/gaurav-nelson/rhacs-docs/edit/main/docs/modules/configuration/pages/configure-proxy.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring a proxy for external network access</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph _abstract">
<p>If your network configuration restricts outbound traffic through proxies, you can configure proxy settings in Red Hat Advance Cluster Security for Kuberenetes to route traffic through a proxy.</p>
</div>
<div class="paragraph">
<p>When you use a proxy with Red Hat Advance Cluster Security for Kuberenetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All outgoing HTTP, HTTPS, and other TCP traffic from Central and Scanner goes through the proxy.</p>
</li>
<li>
<p>Traffic between Central and Scanner does not go through the proxy.</p>
</li>
<li>
<p>The proxy configuration does not affect the other Red Hat Advance Cluster Security for Kuberenetes components.</p>
</li>
<li>
<p>When you are not using the offline mode, and a Collector running in a secured cluster needs to download an additional kernel module or eBPF probe at runtime:</p>
<div class="ulist">
<ul>
<li>
<p>The collector attempts to download them by contacting Sensor.</p>
</li>
<li>
<p>The Sensor then forwards this request to Central.</p>
</li>
<li>
<p>Central uses the proxy to locate the module or probe at <code>https://collector-modules.stackrox.io</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-proxy-on-an-existing-deployment_configure-proxy"><a class="anchor" href="#configure-proxy-on-an-existing-deployment_configure-proxy"></a>Configuring a proxy on an existing deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure a proxy in an existing deployment, you must export the <code>proxy-config</code> secret as a YAML file, update your proxy configuration in that file, and upload it as a secret.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Save the existing secret as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ oc -n stackrox get secret proxy-config \
  -o go-template='{{index .data "config.yaml" | \
  base64decode}}{{"\n"}}' &gt; /tmp/proxy-config.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the fields you want to modify in the YAML configuration file, as specified in the Configure proxy during installation section.</p>
</li>
<li>
<p>After you save the changes, run the following command to replace the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ oc -n stackrox create secret generic proxy-config \
  --from-file=config.yaml=/tmp/proxy-config.yaml -o yaml --dry-run | \
  oc label -f - --local -o yaml app.kubernetes.io/name=stackrox | \
  oc apply -f -</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>You must wait for at least 1 minute, until OpenShift Container Platform propagates your changes to Central and Scanner.</p>
</li>
<li>
<p>If you see any issues with outgoing connections after changing the proxy configuration, you must restart your Central and Scanner pods.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-proxy-during-installation_configure-proxy"><a class="anchor" href="#configure-proxy-during-installation_configure-proxy"></a>Configuring a proxy during installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you are installing Red Hat Advance Cluster Security for Kuberenetes by using the <code>roxctl</code> command-line interface (CLI) or Helm, you can specify your proxy configuration during the installation.</p>
</div>
<div class="paragraph">
<p>When you run the installer by using the <code>roxctl central generate</code> command, the installer generates the secrets and deployment configuration files for your environment. You can configure a proxy by editing the generated configuration secret (YAML) file. Currently, you cannot configure proxies by using the <code>roxctl</code> CLI. The configuration is stored in a Kubernetes secret and it is shared by both Central and Scanner.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the configuration file <code>central/proxy-config-secret.yaml</code> from your deployment bundle directory.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Helm the configuration file is at <code>central/templates/proxy-config-secret.yaml</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Edit the fields you want to modify in the configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: stackrox
  name: proxy-config
type: Opaque
stringData:
  config.yaml: |- <i class="conum" data-value="4"></i><b>(4)</b>
    # # NOTE: Both central and scanner should be restarted if this secret is changed.
    # # While it is possible that some components will pick up the new proxy configuration
    # # without a restart, it cannot be guaranteed that this will apply to every possible
    # # integration etc.
    # url: http://proxy.name:port <i class="conum" data-value="2"></i><b>(2)</b>
    # username: username <i class="conum" data-value="1"></i><b>(1)</b>
    # password: password <i class="conum" data-value="1"></i><b>(1)</b>
    # # If the following value is set to true, the proxy wil NOT be excluded for the default hosts:
    # # - *.stackrox, *.stackrox.svc
    # # - localhost, localhost.localdomain, 127.0.0.0/8, ::1
    # # - *.local
    # omitDefaultExcludes: false
    # excludes:  # hostnames (may include * components) for which you do not <i class="conum" data-value="3"></i><b>(3)</b>
    # # want to use a proxy, like in-cluster repositories.
    # - some.domain
    # # The following configuration sections allow specifying a different proxy to be used for HTTP(S) connections.
    # # If they are omitted, the above configuration is used for HTTP(S) connections as well as TCP connections.
    # # If only the `http` section is given, it will be used for HTTPS connections as well.
    # # Note: in most cases, a single, global proxy configuration is sufficient.
    # http:
    #   url: http://http-proxy.name:port <i class="conum" data-value="2"></i><b>(2)</b>
    #   username: username <i class="conum" data-value="1"></i><b>(1)</b>
    #   password: password <i class="conum" data-value="1"></i><b>(1)</b>
    # https:
    #   url: http://https-proxy.name:port <i class="conum" data-value="2"></i><b>(2)</b>
    #   username: username <i class="conum" data-value="1"></i><b>(1)</b>
    #   password: password <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adding a <code>username</code> and a <code>password</code> is optional, both at the beginning and in the <code>http</code> and <code>https</code> sections.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>url</code> option supports the following URL schemes:
<div class="ulist">
<ul>
<li>
<p><code>http://</code> for an HTTP proxy.</p>
</li>
<li>
<p><code>https://</code> for a TLS-enabled HTTP proxy.</p>
</li>
<li>
<p><code>socks5://</code> for a SOCKS5 proxy.</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>excludes</code> list can contain DNS names (with or without <code>*</code> wildcards), IP addresses, or IP blocks in CIDR notation (for example, <code>10.0.0.0/8</code>).
The values in this list are applied to all outgoing connections, regardless of protocol.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>|-</code> line in the <code>stringData</code> section indicates the start of the configuration data.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When you first open the file, all values are commented out (by using the <code>#</code> sign at the beginning of the line).
Lines starting with double hash signs <code># #</code> contain explanation of the configuration keys.</p>
</li>
<li>
<p>Make sure that when you edit the fields, you maintain an indentation level of two spaces relative to the <code>config.yaml: |-</code> line.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>After editing the configuration file, you can proceed with your usual installation.
The updated configuration instructs Red Hat Advance Cluster Security for Kuberenetes to use the proxy running on the provided address and the port number.</p>
</li>
</ol>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
