<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Adding custom certificates :: RHACS documentation</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">RHACS documentation</a>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhacs" data-version="3.65">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat Advance Cluster Security for Kubernetes</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Welcome</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Release notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/365-release-notes.html">Relase notes for RHACS 3.65</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/364-release-notes.html">Relase notes for RHACS 3.64</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/363-release-notes.html">Release notes for RHACS 3.63</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3062-release-notes.html">Release notes for RHACS 3.0.62</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3061-release-notes.html">Release notes for RHACS 3.0.61</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3060-release-notes.html">Release notes for RHACS 3.0.60</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3059-release-notes.html">Release notes for RHACS 3.0.59</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release_notes/3058-release-notes.html">Release notes for RHACS 3.0.58</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture/acs-architecture.html">Product architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/prerequisites.html">Installation prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/install-ocp-operator.html">Installing by using an Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installing by using Helm charts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installing/installing_helm/install-helm-quick.html">Installing quickly</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installing/installing_helm/install-helm-customization.html">Installing with customizations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/install-quick-roxctl.html">Installing quickly by using the roxctl CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing/uninstall-acs.html">Uninstalling RHACS</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuring</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="add-custom-certificates.html">Adding custom certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-trusted-ca.html">Adding trusted certificate authorities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reissue-internal-certificates.html">Reissuing internal certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-security-notices.html">Adding security notices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enable-offline-mode.html">Enabling offline mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enable-alert-data-retention.html">Enabling alert data retention</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="expose-portal-over-http.html">Exposing the RHACS portal over HTTP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-automatic-upgrades.html">Configuring automatic upgrades for secured clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-proxy.html">Configuring a proxy for external network access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="generate-diagnostic-bundle.html">Generating a diagnostic bundle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-endpoints.html">Configuring endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitor-acs.html">Monitoring with Prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-audit-logging.html">Enabling audit logging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/view-dashboard.html">Viewing the dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-compliance.html">Managing compliance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/evaluate-security-risks.html">Evaluating security risks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/use-admission-controller-enforcement.html">Using admission controller enforcement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-security-policies.html">Managing security policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-network-policies.html">Managing network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/review-cluster-configuration.html">Reviewing cluster configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/examine-images-for-vulnerabilities.html">Examining images for vulnabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/manage-vulnerabilities.html">Managing vulnerabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/respond-to-violations.html">Responding to violations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/search-filter.html">Searching and filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Managing user access</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/configure-okta-identity-cloud.html">Configuring Okta Identity Cloud as a SAML 2.0 identity provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/configure-google-workspace-identity.html">Configuring Google Workspace as an OIDC identity provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/manage-role-based-access-control-3630.html">Managing RBAC in Red Hat Advanced Cluster Security for Kubernetes 3.63 and newer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/manage-role-based-access-control-3062.html">Managing RBAC in Red Hat Advanced Cluster Security for Kubernetes 3.0.62 and older</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../operating/manage-user-access/enable-pki-authentication.html">Enabling PKI authentication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/use-system-health-dashboard.html">Using the system health dashboard</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Backup and restore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup_and_restore/backing-up-acs.html">Backing up Red Hat Advanced Cluster Security for Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup_and_restore/restore-acs.html">Restoring from a backup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Upgrading</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrading/upgrade-helm.html">Upgrading using Helm charts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Upgrading using the roxctl CLI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#upgrading_roxctl/upgrade-from-44">Upgrading from Red Hat Advanced Cluster Security for Kubernetes 3.0.44 or higher</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cli/getting-started-cli.html">Getting started with the roxctl CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../support/getting-support.html">Getting support for Red Hat Advanced Cluster Security for Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../support/getting-support-stackrox.html">Getting support for the StackRox Kubernetes Security Platform</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat Advance Cluster Security for Kubernetes</span>
    <span class="version">3.65</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat Advance Cluster Security for Kubernetes</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.65</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat Advance Cluster Security for Kubernetes</a></li>
    <li>Configuring</li>
    <li><a href="add-custom-certificates.html">Adding custom certificates</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/gaurav-nelson/rhacs-docs/edit/main/docs/modules/configuration/pages/add-custom-certificates.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Adding custom certificates</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Learn how to use a custom TLS certificate with Red Hat Advanced Cluster Security for Kubernetes. After you set up a certificate, users and API clients do not have to bypass the certificate security warnings when connecting to Central.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add-custom-security-cert"><a class="anchor" href="#add-custom-security-cert"></a>Adding a custom security certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can apply a security certificate during the installation or on an existing Red Hat Advanced Cluster Security for Kubernetes deployment.</p>
</div>
<div class="sect2">
<h3 id="custom-cert-prerequisites_add-custom-cert"><a class="anchor" href="#custom-cert-prerequisites_add-custom-cert"></a>Prerequisites for adding custom certificates</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must already have PEM-encoded private key and certificate files.</p>
</li>
<li>
<p>The certificate file should begin and end with human-readable blocks. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">-----BEGIN CERTIFICATE-----
MIICLDCCAdKgAwIBAgIBADAKBggqhkjOPQQDAjB9MQswCQYDVQQGEwJCRTEPMA0G
...
l4wOuDwKQa+upc8GftXE2C//4mKANBC6It01gUaTIpo=
-----END CERTIFICATE-----</code></pre>
</div>
</div>
</li>
<li>
<p>The certificate file can contain either a single (leaf) certificate, or a certificate chain.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If the certificate is not directly signed by a trusted root, you must provide the full certificate chain, including any intermediate certificates.</p>
</li>
<li>
<p>All certificates in the chain must be in order so that the leaf certificate is the first and the root certificate is the last in the chain.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you are using a custom certificate that is not globally trusted, you must also configure the Sensor to trust your custom certificate.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="custom-cert-new-install_add-custom-cert"><a class="anchor" href="#custom-cert-new-install_add-custom-cert"></a>Adding a custom certificate during a new installation</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>If you are installing Red Hat Advanced Cluster Security for Kubernetes using Helm:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add your custom certificate and its key in the <code>values-private.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">central:
  # Configure a default TLS certificate (public cert + private key) for central
  defaultTLS:
    cert: |
      -----BEGIN CERTIFICATE-----
      MIIMIICLDCCAdKgAwIBAgIBADAKBggqhkjOPQQDAjB9MQswCQYDVQQGEwJCRTEPMA0G
      ...
      -----END CERTIFICATE-----
    key: |
      -----BEGIN EC PRIVATE KEY-----
      MHcl4wOuDwKQa+upc8GftXE2C//4mKANBC6It01gUaTIpo=
      ...
      -----END EC PRIVATE KEY-----</code></pre>
</div>
</div>
</li>
<li>
<p>Provide the configuration file during the installation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ helm install -n stackrox --create-namespace stackrox-central-services rhacs/central-services -f values-private.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you are installing Red Hat Advanced Cluster Security for Kubernetes using the <code>roxctl</code> CLI, provide the certificate and key files when you run the installer:</p>
<div class="ulist">
<ul>
<li>
<p>For the non-interactive installer, use the <code>--default-tls-cert</code> and   <code>--default-tls-key</code> options:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ roxctl central generate --default-tls-cert "cert.pem" --default-tls-key "key.pem"</code></pre>
</div>
</div>
</li>
<li>
<p>For the interactive installer, provide the certificate and key files when   you enter answers for the prompts:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">...
Enter PEM cert bundle file (optional): &lt;cert.pem&gt;
Enter PEM private key file (optional): &lt;key.pem&gt;
Enter administrator password (default: autogenerated):
Enter orchestrator (k8s, openshift): openshift
...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="custom-cert-existing_add-custom-cert"><a class="anchor" href="#custom-cert-existing_add-custom-cert"></a>Adding a custom certificate for an existing instance</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>If you have installed Red Hat Advanced Cluster Security for Kubernetes using Helm:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add your custom certificate and its key in the <code>values-private.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">central:
  # Configure a default TLS certificate (public cert + private key) for central
  defaultTLS:
    cert: |
      -----BEGIN CERTIFICATE-----
      MIIMIICLDCCAdKgAwIBAgIBADAKBggqhkjOPQQDAjB9MQswCQYDVQQGEwJCRTEPMA0G
      ...
      -----END CERTIFICATE-----
    key: |
      -----BEGIN EC PRIVATE KEY-----
      MHcl4wOuDwKQa+upc8GftXE2C//4mKANBC6It01gUaTIpo=
      ...
      -----END EC PRIVATE KEY-----</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>helm upgrade</code> command and provide the updated configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ helm upgrade -n stackrox --create-namespace stackrox-central-services rhacs/central-services -f values-private.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you have installed Red Hat Advanced Cluster Security for Kubernetes using the <code>roxctl</code> CLI:</p>
<div class="ulist">
<ul>
<li>
<p>Create and apply a TLS secret from the PEM-encoded key and certificate files:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ oc -n stackrox create secret tls central-default-tls-cert \
  --cert &lt;server_cert.pem&gt; \
  --key &lt;server_key.pem&gt; \
  --dry-run -o yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you run this command, Central automatically applies the new key and certificate without requiring the pod to be restarted. It might take up to a minute to propagate the changes.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-sensor-to-trust-cert"><a class="anchor" href="#configure-sensor-to-trust-cert"></a>Configuring Sensor to trust custom certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using a custom certificate that is not trusted globally, you must configure the Sensor to trust your custom certificate.
Otherwise, you might get errors.
The specific type of error may vary based on your setup and the certificate you use.
Usually, it is an <code>x509 validation</code> related error.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You do not need to configure the Sensor to trust your custom certificate if you are using a globally trusted certificate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="proc_downloading-sensor-bundle_add-custom-cert"><a class="anchor" href="#proc_downloading-sensor-bundle_add-custom-cert"></a>Downloading a Sensor bundle</h3>
<div class="paragraph _abstract">
<p>The Sensor bundle includes the necessary configuration files and scripts to install Sensor. You can download the Sensor bundle from the RHACS portal.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the RHACS portal.</p>
</li>
<li>
<p>Go to <strong>Platform Configuration</strong> &#8594; <strong>Clusters</strong>.</p>
</li>
<li>
<p>Click <strong>New Cluster</strong> and specify a name for the cluster.</p>
</li>
<li>
<p>If you are deploying the Sensor in the same cluster, accept the default values for all the fields.
Otherwise, if you are deploying into a different cluster, replace the address <code>central.stackrox.svc:443</code> with a load balancer, node port, or other address (including the port number) that is accessible from the other cluster in which you are planning to install.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using a non-gRPC capable load balancer, such as HAProxy, AWS Application Load Balancer (ALB), or AWS Elastic Load Balancing (ELB) use the WebSocket Secure (<code>wss</code>) protocol.
To use <code>wss</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prefix the address with <code>wss://</code>, and</p>
</li>
<li>
<p>Add the port number after the address, for example, <code>wss://stackrox-central.example.com:443</code>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Next</strong> to continue.</p>
</li>
<li>
<p>Click <strong>Download YAML File and Keys</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trust-cert-new-sensor_add-custom-cert"><a class="anchor" href="#trust-cert-new-sensor_add-custom-cert"></a>Configuring Sensor to trust custom certificates when deploying a new Sensor</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have downloaded the Sensor bundle.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>If you are using the <code>sensor.sh</code> script:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unzip the Sensor bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ unzip -d sensor sensor-&lt;cluster_name&gt;.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>sensor.sh</code> script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ ./sensor/sensor.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The certificates are automatically applied when you run the sensor (<code>./sensor/sensor.sh</code>) script.
You can also place additional custom certificates in the <code>sensor/additional-cas/</code> directory before you run the <code>sensor.sh</code> script.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you are not using the <code>sensor.sh</code> script:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unzip the Sensor bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ unzip -d sensor sensor-&lt;cluster_name&gt;.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command to create the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ ./sensor/ca-setup-sensor.sh -d sensor/additional-cas/ <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the <code>-d</code> option to specify a directory containing custom certificates.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you get the "secret already exists" error message, re-run the script with the <code>-u</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ ./sensor/ca-setup-sensor.sh -d sensor/additional-cas/ -u</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Continue Sensor deployment by using the YAML files.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="trust-cert-existing-sensor_add-custom-cert"><a class="anchor" href="#trust-cert-existing-sensor_add-custom-cert"></a>Configuring an existing Sensor to trust custom certificates</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have downloaded the Sensor bundle.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Unzip the Sensor bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ unzip -d sensor sensor-&lt;cluster_name&gt;.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command to create the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ ./sensor/ca-setup-sensor.sh -d sensor/additional-cas/ <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the <code>-d</code> option to specify a directory containing custom certificates.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you get the "secret already exists" error message, re-run the script with the <code>-u</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ ./sensor/ca-setup-sensor.sh -d sensor/additional-cas/ -u</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Continue Sensor deployment by using the YAML files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you added the certificates to an existing sensor, you must restart the Sensor container.</p>
</div>
<div class="sect3">
<h4 id="restart-sensor_add-custom-cert"><a class="anchor" href="#restart-sensor_add-custom-cert"></a>Restarting the Sensor container</h4>
<div class="paragraph _abstract">
<p>You can restart the Sensor container either by killing the container or by deleting the Sensor pod.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Run the following command to kill the Sensor container:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must wait for at least 1 minute, until OpenShift Container Platform or Kubernetes propagates your changes and restarts the Sensor container.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>On OpenShift Container Platform:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ oc -n stackrox deploy/sensor -c sensor -- kill 1</code></pre>
</div>
</div>
</li>
<li>
<p>On Kubernetes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ kubectl -n stackrox deploy/sensor -c sensor -- kill 1</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Or, run the following command to delete the Sensor pod:</p>
<div class="ulist">
<ul>
<li>
<p>On OpenShift Container Platform:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ oc -n stackrox delete pod -lapp=sensor</code></pre>
</div>
</div>
</li>
<li>
<p>On Kubernetes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-terminal hljs" data-lang="terminal">$ kubectl -n stackrox delete pod -lapp=sensor</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footer-container">
    <span class="footer-image">
      <img src="https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
    </span>
    <span class="footer-text">
      Copyright Â© 2021 Red Hat, Inc.
    </span>
</footer>
<script>
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/rhacs/3.65/configuration/add-custom-certificates.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/rhacs/3.65/configuration/add-custom-certificates.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
